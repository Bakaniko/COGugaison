<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apprendre les principales fonctionnalités de COGugaison • COGugaison</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">COGugaison</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/antuki/COGugaison">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Apprendre les principales fonctionnalités de COGugaison</h1>
                        <h4 class="author">antuki</h4>
            
          </div>

    
    
<div class="contents">
<div id="introduction-a-cogugaison" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-a-cogugaison" class="anchor"></a>Introduction à COGugaison</h2>
<p>Nous allons balayer dans cette vignette les principales fonctionnalités du package <code>COGugaison</code>.</p>
<p>Ce package a pour objectif global de manipuler des données communales produites à différents millésimes. Il permet actuellement de : * détecter le millésime du code officiel géographique d’une table de données communales : fonction <code>COG_akinator</code> * visualiser les modifications communales (fusions, défusions, changements de codes ou de noms) qui ont eu lieu entre deux dates : <code>modifications_communales</code> * transformer des tables de données numériques en géographie au premier janvier d’une année souhaitée : <code>changement_COG_varNum</code> * transformer des typologies de communes en géographie au premier janvier d’une année souhaitée en ayant le choix entre plusieurs hypothèses de classement en cas de fusion de communes de classes différentes (attribuer la classe qui contient le plus de population, définir une classe absorbante ou une classe spécifique aux regroupements de plusieurs communes de classes différentes) : <code>changement_COG_typo</code>.Il est également possible d’isoler dans une table les communes fusionnées appartenant à des classes différentes : <code>changement_COG_typo_details</code>. * permettre d’agréger les tables de données communales à de nombreux échelons supra-communaux administratifs (EPCI, arrondissements, cantons-villes, départements, régions) ou d’étude (bassins de vie, zones d’emploi, unités urbaines, aires urbaines) : <code>nivsupra</code>. * gérer des cas particuliers comme les codes Insee des communes corses (<code>modification_Corse</code>) ou des arrondissements municipaux de Paris, Lyon, et Marseille (<code>enlever_PLM</code>)</p>
<p>Il est à noter que la version actuellement en ligne du package correspond à un premier développement qui comporte des imperfections. L’idée est donc à ce stade que les personnes qui utilisent régulièrement des bases de données communales produites à différents millésimes testent ses fonctionnalités, détectent ses bugs et ses manques pour l’améliorer.</p>
<p>Il est également important de souligner que les données utilisées ici s’appuient sur des tables publiées par l’Insee : - <a href="https://www.insee.fr/fr/information/2666684#titre-bloc-11">l’historique des géographies communales</a> - <a href="https://www.insee.fr/fr/information/2028028">les tables d’appartenance des communes aux différents niveaux géographiques</a></p>
<p>Tant que le package n’est pas stabilisé, il est évidemment conseillé de se référer aux données officielles de l’Insee en cas de doute sur un résultat.</p>
<p>Commençons par installer le package <code>COGugaison</code> et à le charger dans R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools::<span class="kw">install_github</span>(<span class="st">"antuki/COGugaison"</span>)</code></pre></div>
<pre><code>## Downloading GitHub repo antuki/COGugaison@master
## from URL https://api.github.com/repos/antuki/COGugaison/zipball/master</code></pre>
<pre><code>## Installing COGugaison</code></pre>
<pre><code>## "C:/PROGRA~1/R/R-33~1.2/bin/x64/R" --no-site-file --no-environ --no-save  \
##   --no-restore --quiet CMD INSTALL "C:/Users/Kim  \
##   Antunez/AppData/Local/Temp/RtmpSgxSJl/devtools336cb3317e0/antuki-COGugaison-aaacb70"  \
##   --library="C:/Users/Kim Antunez/Documents/R/win-library/3.3"  \
##   --install-tests</code></pre>
<pre><code>## </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(COGugaison)</code></pre></div>
</div>
<div id="quel-code-officiel-geographique-est-utilise" class="section level2">
<h2 class="hasAnchor">
<a href="#quel-code-officiel-geographique-est-utilise" class="anchor"></a>Quel code officiel géographique est utilisé ?</h2>
<p>Nous allons maintenant manipuler une table exemple incluse dans le package, la table <code>exemple_popcom</code> qui contient comme variables le code géographique de la commune (CODGEO), son nom (LIBGEO), sa population en 2012 (P12_POP), sa superficie (SUPERF) ainsi que deux typologies de territoires générées aléatoirement (typoA et typoB). Il faut veiller à ce que les variables numériques soient au bon format dans R et que les typologies et identifiants soient au format caractère (si ce n’est pas le cas, il faudra les transformer avec les fonctions <em>as.numeric</em> et <em>as.character</em>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(exemple_popcom)</code></pre></div>
<pre><code>##   CODGEO                  LIBGEO P12_POP SUPERF    typoA typoB
## 1  01001 L'Abergement-Clémenciat     777     16 CLASSE 2     F
## 2  01002   L'Abergement-de-Varey     235      9 CLASSE 3     D
## 3  01004       Ambérieu-en-Bugey   14233     25 CLASSE 1     B
## 4  01005     Ambérieux-en-Dombes    1642     16 CLASSE 3     F
## 5  01006                 Ambléon     110      6 CLASSE 4     E
## 6  01007                Ambronay    2437     34 CLASSE 5     A</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(exemple_popcom)</code></pre></div>
<pre><code>## 'data.frame':    36664 obs. of  6 variables:
##  $ CODGEO : chr  "01001" "01002" "01004" "01005" ...
##  $ LIBGEO : chr  "L'Abergement-Clémenciat" "L'Abergement-de-Varey" "Ambérieu-en-Bugey" "Ambérieux-en-Dombes" ...
##  $ P12_POP: int  777 235 14233 1642 110 2437 739 338 1069 385 ...
##  $ SUPERF : int  16 9 25 16 6 34 5 7 29 15 ...
##  $ typoA  : chr  "CLASSE 2" "CLASSE 3" "CLASSE 1" "CLASSE 3" ...
##  $ typoB  : chr  "F" "D" "B" "F" ...</code></pre>
<p>La fonction <code>COG_akinator</code> permet de donner des pistes à l’utilisateur sur le code officiel géographique (COG) utilisé dans sa table de données communales, c’est-à-dire de savoir si la liste de communes utilisée correspond à la liste officiel au premier janvier de 2017 ? de 2016 ? ou d’une autre année.</p>
<p>Le paramètre <em>donnees_insee</em> vaut TRUE si les données manipulées sont produites par l’Insee. En effet, quelques rares modifications communales (la défusion des communes Loisey et Culey au 1er janvier 2014 par exemple) ont été prises en compte dans les bases de données communales de l’Insee plus tard que la date officielle (se référer à la documentation de la fonction pour plus de précisions). Le paramètre <em>liste_complete</em> vaut TRUE si le vecteur de communes du paramètre <em>vecteur_codgeo</em> liste l’ensemble des communes françaises et FALSE s’il en liste seulement un extrait.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/COG_akinator.html">COG_akinator</a></span>(<span class="dt">vecteur_codgeo=</span>exemple_popcom[,<span class="dv">1</span>],<span class="dt">donnees_insee=</span>T, <span class="dt">liste_complete=</span>T)</code></pre></div>
<pre><code>## [1] "COG2014"</code></pre>
<p>En l’occurrence la liste de communes utilisée dans cette table correspond à la liste des communes au 1er janvier 2014.</p>
</div>
<div id="quelles-modifications-communales-ont-eu-lieu-entre-deux-dates" class="section level2">
<h2 class="hasAnchor">
<a href="#quelles-modifications-communales-ont-eu-lieu-entre-deux-dates" class="anchor"></a>Quelles modifications communales ont eu lieu entre deux dates ?</h2>
<p>La fonction <code>modifications_communales</code> permet, comme son nom l’indique, de visualiser les modifications communales (fusions, défusions, changements de codes ou de noms) qui ont eu lieu entre deux dates. Ici entre le 01/01/2014 et le 01/01/2015. Cette fonction est encore en cours de développement il est donc possible que certains évènements ne soient pas encore pris en compte. Il ne faut pas hésiter à le signaler.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">modifs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/modifications_communales.html">modifications_communales</a></span>(<span class="dt">date_debut=</span><span class="st">"01-01-2014"</span>,<span class="dt">date_fin=</span><span class="st">"01-01-2015"</span>)
<span class="kw">cat</span>(modifs$fusions)</code></pre></div>
<pre><code>## 2015-01-01 : Notre-Dame-d'Estrées-Corbon (14474) est un rassemblement de Corbon (14178), Notre-Dame-d'Estrées (14474) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Auxons (25035) est un rassemblement de Auxon-Dessous (25034), Auxon-Dessus (25035) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Goussainville (28185) est un rassemblement de Champagne (28069), Goussainville (28185) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Eclose-Badinières (38152) est un rassemblement de Badinières (38024), Eclose (38152) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Saint-Crépin-Ibouvillers (60570) est un rassemblement de Montherlant (60417), Saint-Crépin-Ibouvillers (60570) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Montsecret-Clairefougère (61292) est un rassemblement de Clairefougère (61109), Montsecret (61292) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Boischampré (61375) est un rassemblement de Marcei (61249), Saint-Christophe-le-Jajolet (61375), Saint-Loyer-des-Champs (61417), Vrigny (61511) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Tinchebray-Bocage (61486) est un rassemblement de Beauchêne (61031), Frênes (61177), Larchamp (61223), Saint-Cornier-des-Landes (61377), Saint-Jean-des-Bois (61410), Tinchebray (61486), Yvrandes (61513) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Vaugneray (69255) est un rassemblement de Saint-Laurent-de-Vaux (69221), Vaugneray (69255) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Clux-Villeneuve (71578) est un rassemblement de Clux (71138), Villeneuve (71578) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Villeneuve-en-Perseigne (72137) est un rassemblement de Chassé (72069), Fresnaye-sur-Chédouet (72137), Lignières-la-Carelle (72162), Montigny (72207), Roullée (72258), Saint-Rigomer-des-Bois (72318) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Saint-Offenge (73263) est un rassemblement de Saint-Offenge-Dessous (73263), Saint-Offenge-Dessus (73264) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Orvanne (77316) est un rassemblement de Écuelles (77166), Moret-sur-Loing (77316) [commune nouvelle avec commune(s) déléguée(s)].</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(modifs$defusions)</code></pre></div>
<pre><code>## ATTENTION, l'évènement suivant a été pris en compte dans les données de l'Insee seulement au 01/01/2015 : 2014-01-01 : Loisey (55298) s'est séparée en Loisey (55298), Culey (55138) [rétablissement].</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(modifs$changements_codes)</code></pre></div>
<pre><code>## 2014-01-07 : Le code commune de Oudon passe de 14697 à 14472 [changement de code dû à un changement de chef-lieu].</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(modifs$changements_noms)</code></pre></div>
<pre><code>## 2014-12-06 : La commune de Barisis (02049) change de nom en Barisis-aux-Bois [changement de nom].
## 2014-12-06 : La commune de Sainte-Colombe (21544) change de nom en Sainte-Colombe-en-Auxois [changement de nom].
## 2014-12-06 : La commune de Pont-de-Roide (25463) change de nom en Pont-de-Roide-Vermondans [changement de nom].
## 2014-12-06 : La commune de Cazaril-Laspènes (31129) change de nom en Cazarilh-Laspènes [changement de nom].
## 2014-12-06 : La commune de Saint-Martin (66184) change de nom en Saint-Martin-de-Fenouillet [changement de nom].
## 2014-12-06 : La commune de Cré (72108) change de nom en Cré-sur-Loir [changement de nom].
## 2014-12-06 : La commune de Belbèse (82015) change de nom en Belbèze-en-Lomagne [changement de nom].
## 2014-12-06 : La commune de Saint-Vincent (82174) change de nom en Saint-Vincent-d'Autéjac [changement de nom].</code></pre>
</div>
<div id="transformer-des-variables-numeriques-en-autre-geographie" class="section level2">
<h2 class="hasAnchor">
<a href="#transformer-des-variables-numeriques-en-autre-geographie" class="anchor"></a>Transformer des variables numériques en autre géographie</h2>
<p>La fonction <code>changement_COG_varNum</code> permet de transformer des tables de données numériques communales en géographie au premier janvier d’une année souhaitée.</p>
<p>Ici, nous allons transformer les variables numériques de la table <em>exemple_pop</em> afin de récupérer les données de population et de superficie des communes au 1er janvier 2017 (au lieu de 2014).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_popcom_COG2017_num &lt;-<span class="st"> </span><span class="kw"><a href="../reference/changement_COG_varNum.html">changement_COG_varNum</a></span>(<span class="dt">table_entree=</span>exemple_popcom,<span class="dt">annees=</span><span class="kw">c</span>(<span class="dv">2014</span>:<span class="dv">2017</span>),<span class="dt">agregation=</span>T,<span class="dt">libgeo=</span><span class="st">"LIBGEO"</span>,<span class="dt">donnees_insee=</span>T)
<span class="kw">head</span>(exemple_popcom_COG2017_num)</code></pre></div>
<pre><code>##   CODGEO                  LIBGEO P12_POP SUPERF
## 1  01001 L'Abergement-Clémenciat     777     16
## 2  01002   L'Abergement-de-Varey     235      9
## 3  01004       Ambérieu-en-Bugey   14233     25
## 4  01005     Ambérieux-en-Dombes    1642     16
## 5  01006                 Ambléon     110      6
## 6  01007                Ambronay    2437     34</code></pre>
<p>Le paramètre <em>agregation</em> vaut TRUE si la table souhaitée doit sommer toutes les lignes qui concernent une même commune et FALSE si l’on souhaite volontairement conserver les doublons dans les codes commune (dans les tables de flux par exemple, cf. plus bas). Le paramètre <em>libgeo</em> doit être conservé à NULL si la table souhaitée ne contient pas de libellés de communes, sinon il doit indiquer le nom de la variable renseignant sur le libellé de la commune (celui présent dans la table si il existe déjà ou tout autre nom s’il doit être ajouté).</p>
</div>
<div id="transformer-des-typologies-en-autre-geographie" class="section level2">
<h2 class="hasAnchor">
<a href="#transformer-des-typologies-en-autre-geographie" class="anchor"></a>Transformer des typologies en autre géographie</h2>
<p>La fonction <code>changement_COG_typo</code> permet de transformer des typologies de communes en géographie au premier janvier d’une année souhaitée. Ici nous allons transformer les deux typologies (typoA et typoB) de la table <em>exemple_pop</em> en géographie communale au 1er janvier 2017 (au lieu de 2014).</p>
<p>Ici, l’hypothèse de classement en cas de fusion de communes (<em>methode_fusion</em>) choisie est celle d’une classe spécifique (<em>methode_difference</em>, classe appelée <em>mot_difference</em>=“differents”) aux regroupements de plusieurs communes de classes différentes. Les autres hypothèses possibles auraient pu être l’hypothèse du maximum de population <em>methode_max_pop</em> ou de classe absorbante <em>methode_classe_absorbante</em>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_popcom_COG2017_typo &lt;-<span class="st"> </span><span class="kw"><a href="../reference/changement_COG_typo.html">changement_COG_typo</a></span>(<span class="dt">table_entree=</span>exemple_popcom[,-<span class="dv">2</span>],<span class="dt">annees=</span><span class="kw">c</span>(<span class="dv">2014</span>:<span class="dv">2017</span>),<span class="dt">methode_fusion=</span><span class="st">"methode_difference"</span>,<span class="dt">typos=</span><span class="kw">c</span>(<span class="st">"typoA"</span>,<span class="st">"typoB"</span>),<span class="dt">mot_difference =</span> <span class="st">"differents"</span>,<span class="dt">libgeo=</span><span class="st">"LIB"</span>,<span class="dt">donnees_insee=</span>T)
<span class="kw">head</span>(exemple_popcom_COG2017_typo)</code></pre></div>
<pre><code>##   CODGEO                     LIB    typoA typoB
## 1  01001 L'Abergement-Clémenciat CLASSE 2     F
## 2  01002   L'Abergement-de-Varey CLASSE 3     D
## 3  01004       Ambérieu-en-Bugey CLASSE 1     B
## 4  01005     Ambérieux-en-Dombes CLASSE 3     F
## 5  01006                 Ambléon CLASSE 4     E
## 6  01007                Ambronay CLASSE 5     A</code></pre>
<p>La fonction <code>changement_COG_typo_details</code> permet quant à elle d’isoler dans une table les communes fusionnées appartenant à des classes différentes, ici selon la typologie “typoA” entre 2014 et 2015 puis 2015 et 2016 et 2016 et 2017.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">details_exemple_popcom_COG2017_typo &lt;-<span class="st"> </span><span class="kw"><a href="../reference/changement_COG_typo_details.html">changement_COG_typo_details</a></span>(<span class="dt">table_entree=</span>exemple_popcom[,-<span class="dv">2</span>],<span class="dt">annees=</span><span class="kw">c</span>(<span class="dv">2014</span>:<span class="dv">2017</span>),<span class="dt">typo=</span><span class="st">"typoA"</span>, <span class="dt">donnees_insee=</span>T)
<span class="kw">head</span>(details_exemple_popcom_COG2017_typo[[<span class="st">"2014_2015"</span>]])</code></pre></div>
<pre><code>##   cod2014              lib2014 cod2015                     lib2015
## 1   14178               Corbon   14474 Notre-Dame-d'Estrées-Corbon
## 2   14474 Notre-Dame-d'Estrées   14474 Notre-Dame-d'Estrées-Corbon
## 3   25034        Auxon-Dessous   25035                  Les Auxons
## 4   25035         Auxon-Dessus   25035                  Les Auxons
## 5   38024           Badinières   38152           Eclose-Badinières
## 6   38152               Eclose   38152           Eclose-Badinières
##      typoA
## 1 CLASSE 2
## 2 CLASSE 4
## 3 CLASSE 1
## 4 CLASSE 3
## 5 CLASSE 4
## 6 CLASSE 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(details_exemple_popcom_COG2017_typo[[<span class="st">"2015_2016"</span>]])</code></pre></div>
<pre><code>##   cod2015             lib2015 cod2016            lib2016    typoA
## 1   01015           Arbignieu   01015    Arboys en Bugey CLASSE 3
## 2   01340          Saint-Bois   01015    Arboys en Bugey CLASSE 2
## 3   01119           Corcelles   01080 Champdor-Corcelles CLASSE 1
## 4   01080            Champdor   01080 Champdor-Corcelles CLASSE 2
## 5   01176 Le Grand-Abergement   01187      Haut Valromey CLASSE 2
## 6   01409             Songieu   01187      Haut Valromey CLASSE 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(details_exemple_popcom_COG2017_typo[[<span class="st">"2016_2017"</span>]])</code></pre></div>
<pre><code>##   cod2016             lib2016 cod2017          lib2017    typoA
## 1   01095 Chavannes-sur-Suran   01095 Nivigne et Suran CLASSE 5
## 2   01172           Germagnat   01095 Nivigne et Suran CLASSE 1
## 3   01098         Chazey-Bons   01098      Chazey-Bons CLASSE 3
## 4   01316              Pugieu   01098      Chazey-Bons CLASSE 4
## 5   03168             Meaulne   03168   Meaulne-Vitray CLASSE 2
## 6   03318              Vitray   03168   Meaulne-Vitray CLASSE 5</code></pre>
</div>
<div id="agreger-des-tables-de-donnees-communales-a-des-echelons-supra-communaux" class="section level2">
<h2 class="hasAnchor">
<a href="#agreger-des-tables-de-donnees-communales-a-des-echelons-supra-communaux" class="anchor"></a>Agréger des tables de données communales à des échelons supra-communaux</h2>
<p>La fonction <code>nivsupra</code> permet d’agréger les tables de données communales à de nombreux échelons supra-communaux administratifs (EPCI, arrondissements, cantons-villes, départements, régions) ou d’étude (bassins de vie, zones d’emploi, unités urbaines, aires urbaines).</p>
<p>Ici nous agrégeons la population et la superficie des communes à l’échelon géographique des zones d’emploi afin d’obtenir une table des densités de population par zone d’emploi.</p>
<p>Le paramètre <em>na.nivgeo.rm</em> vaut FALSE si la table souhaitée doit contenir une ligne identifiée par un code géographique valant NA qui somme les valeurs de toutes les communes qui n’appartiennent à aucun regroupement supracommunal et vaut TRUE si cette ligne doit être supprimée.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_popcom_COG2017 &lt;-<span class="st"> </span><span class="kw">merge</span>(exemple_popcom_COG2017_num,exemple_popcom_COG2017_typo[,-<span class="dv">2</span>],<span class="dt">by=</span><span class="st">"CODGEO"</span>,<span class="dt">all=</span>T)
exemple_popcom_ZE2010 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nivsupra.html">nivsupra</a></span>(<span class="dt">table_entree=</span>exemple_popcom_COG2017,<span class="dt">nivsupra=</span><span class="st">"ZE2010"</span>,<span class="dt">na.nivgeo.rm=</span>F,<span class="dt">agregation=</span>T)
exemple_popcom_ZE2010$densite &lt;-<span class="st"> </span>exemple_popcom_ZE2010$P12_POP /<span class="st"> </span>exemple_popcom_ZE2010$SUPERF
<span class="kw">head</span>(exemple_popcom_ZE2010)</code></pre></div>
<pre><code>##   ZE2010                         LIBGEO P12_POP SUPERF  densite
## 1   0050                 Mont-de-Marsan  160717   4956 32.42877
## 2   0051                        Alençon  122263   2405 50.83701
## 3   0052                Cosne - Clamecy   75052   2553 29.39757
## 4   0053                          Mâcon  143358   1543 92.90862
## 5   0054               Nogent-le-Rotrou   48665   1227 39.66178
## 6   0055 La Vallée de la Bresle - Vimeu   99095   1134 87.38536</code></pre>
</div>
<div id="enlever-les-arrondissements-municipaux-des-tables-de-donnees-communales" class="section level2">
<h2 class="hasAnchor">
<a href="#enlever-les-arrondissements-municipaux-des-tables-de-donnees-communales" class="anchor"></a>Enlever les arrondissements municipaux des tables de données communales</h2>
<p>Nous allons maintenant manipuler une autre table exemple incluse dans le package, la table <code>exemple_flux</code> qui contient des exemples de flux entre une communes de résidences (COMMUNE) et de travail (DCLT). Elle contient comme autres variables le code de la catégorie socio-professionnelle des individus (CS1), la catégorie d’âge (AGEREVQ) et le poids de l’individu statistique (IPONDI).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(exemple_flux)</code></pre></div>
<pre><code>##   COMMUNE  DCLT CS1 AGEREVQ IPONDI
## 1   55298 45055   5      25      4
## 2   55298 52448   3      50      4
## 3   55298 54323   5      55      4
## 4   55298 55010   6      35      4
## 5   55298 55029   6      20      4
## 6   55298 55029   6      40      4</code></pre>
<p>La fonction <code>enlever_PLM</code> permet de remplacer les codes Insee des arrondissements municipaux de Paris, Lyon et Marseille par leurs codes communes respectifs.</p>
<p>Le paramètre <em>vecteur_entree</em> vaut TRUE si l’élément à transformer est un vecteur de codes insee et FALSE s’il s’agit d’une table de données (data.frame) numériques. Attention, cette fonction ne gère pas les conversions de typologies (variables de type caractère).</p>
<p>Ici nous allons remplacer les arrondissement municipaux par les codes communaux dans la table <code>exemple_flux</code> pour les variables COMMUNE puis DCLT.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_flux_sansPLM &lt;-<span class="kw"><a href="../reference/enlever_PLM.html">enlever_PLM</a></span>(<span class="dt">table_entree=</span>exemple_flux,<span class="dt">codgeo_entree =</span> <span class="st">"COMMUNE"</span>,<span class="dt">libgeo=</span><span class="ot">NULL</span>,<span class="dt">agregation =</span> F,<span class="dt">vecteur_entree=</span>F)
exemple_flux_sansPLM &lt;-<span class="kw"><a href="../reference/enlever_PLM.html">enlever_PLM</a></span>(<span class="dt">table_entree=</span>exemple_flux_sansPLM,<span class="dt">codgeo_entree =</span> <span class="st">"DCLT"</span>,<span class="dt">libgeo=</span><span class="ot">NULL</span>,<span class="dt">agregation =</span> F,<span class="dt">vecteur_entree=</span>F)</code></pre></div>
</div>
<div id="jongler-avec-les-differentes-possibilites-pour-les-codes-communaux-corses" class="section level2">
<h2 class="hasAnchor">
<a href="#jongler-avec-les-differentes-possibilites-pour-les-codes-communaux-corses" class="anchor"></a>Jongler avec les différentes possibilités pour les codes communaux corses</h2>
<p>La fonction <code>modification_Corse</code> permet quant à elle de modifier les codes Insee des communes corses. En effet, en 1976, les codes de toutes les communes corses sont modifiés : alors qu’ils commençaient tous par “20”, leurs deux premiers caractères sont remplacés par “2A” (Corse du Sud) ou “2B” (Corse du Nord). Les codes postaux conservent d’ailleurs aujourd’hui le préfixe historique “20”. Cette fonction est notamment utile pour la raison suivante : dans certaines tables issues des recensements Insee de 1968 ou 1975, les communes sont déjà codées avec les préfixes 2A et 2B.</p>
<p>Le paramètre <em>sens</em> vaut “20vers2A2B” pour changer tous les codes communes corses commençant par 20 par 2A ou 2B et vaut “2A2Bvers20” quand l’effet inverse est recherché.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_flux_sansPLMsansCorse &lt;-<span class="st"> </span><span class="kw"><a href="../reference/modification_Corse.html">modification_Corse</a></span>(<span class="dt">table_entree=</span>exemple_flux_sansPLM,<span class="dt">sens=</span><span class="st">"2A2Bvers20"</span>)</code></pre></div>
</div>
<div id="transformer-des-variables-numeriques-en-autre-geographie-dans-des-donnees-de-flux" class="section level2">
<h2 class="hasAnchor">
<a href="#transformer-des-variables-numeriques-en-autre-geographie-dans-des-donnees-de-flux" class="anchor"></a>Transformer des variables numériques en autre géographie dans des données de flux</h2>
<p>La fonction <code>changement_COG_varNum</code> peut également s’appliquer à des tables de flux (codes communes pouvant comporter des doublons) grâce à l’option agregation = FALSE. Les variables de type caractère sont alors conservées comme telles ou dupliquées en cas de défusion et les variables numériques (ici IPONDI) sommées en cas de fusion ou réparties proportionnellement à la population de chaque commune en cas de défusion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_flux_COG2017 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/changement_COG_varNum.html">changement_COG_varNum</a></span>(<span class="dt">table_entree=</span>exemple_flux_sansPLMsansCorse,<span class="dt">annees=</span><span class="kw">c</span>(<span class="dv">2014</span>:<span class="dv">2017</span>),<span class="dt">codgeo_entree=</span><span class="st">"COMMUNE"</span>,<span class="dt">agregation=</span>F,<span class="dt">libgeo=</span><span class="ot">NULL</span>,<span class="dt">donnees_insee=</span>T)
exemple_flux_COG2017 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/changement_COG_varNum.html">changement_COG_varNum</a></span>(<span class="dt">table_entree=</span>exemple_flux_COG2017,<span class="dt">annees=</span><span class="kw">c</span>(<span class="dv">2014</span>:<span class="dv">2017</span>),<span class="dt">codgeo_entree=</span><span class="st">"DCLT"</span>,<span class="dt">agregation=</span>F,<span class="dt">libgeo=</span><span class="ot">NULL</span>,<span class="dt">donnees_insee=</span>T)</code></pre></div>
</div>
<div id="inserer-dans-des-tables-de-donnees-de-flux-communales-des-echelons-supra-communaux" class="section level2">
<h2 class="hasAnchor">
<a href="#inserer-dans-des-tables-de-donnees-de-flux-communales-des-echelons-supra-communaux" class="anchor"></a>Insérer dans des tables de données de flux communales des échelons supra-communaux</h2>
<p>La fonction <code>nivsupra</code> peut également s’appliquer à des tables de flux (non agrégées par codes communes) grâce à l’option agregation = FALSE. La table en entrée est alors conservée comme telle avec une nouvelle colonne qui correspond au niveau supracommunal du code commune considéré.</p>
<p>Ici, on ajoute les colonnes ZE2010_COMMUNE et ZE2010_DCLT à la table de flux domicile-travail utilisée précédemment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_flux_COG2017_etZE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nivsupra.html">nivsupra</a></span>(<span class="dt">table_entree=</span>exemple_flux_COG2017,<span class="dt">codgeo_entree=</span><span class="st">"COMMUNE"</span>,<span class="dt">nivsupra=</span><span class="st">"ZE2010"</span>,<span class="dt">na.nivgeo.rm=</span>F,<span class="dt">agregation=</span>F)
exemple_flux_COG2017_etZE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nivsupra.html">nivsupra</a></span>(<span class="dt">table_entree=</span>exemple_flux_COG2017_etZE,<span class="dt">codgeo_entree=</span><span class="st">"DCLT"</span>,<span class="dt">nivsupra=</span><span class="st">"ZE2010"</span>,<span class="dt">na.nivgeo.rm=</span>F,<span class="dt">agregation=</span>F)
<span class="kw">head</span>(exemple_flux_COG2017_etZE)</code></pre></div>
<pre><code>##    DCLT COMMUNE CS1 AGEREVQ   IPONDI ZE2010_COMMUNE ZE2010_DCLT
## 1 02528   61099   4      35 4.177122           0054        2206
## 2 03085   61237   5      25 3.924528           2511        8302
## 3 03085   61006   6      40 2.773158           2511        8302
## 4 03085   61462   6      25 4.693373           2511        8302
## 5 03085   61472   6      50 5.095541           2511        8302
## 6 03085   61006   4      55 2.716909           2511        8302</code></pre>
<p>Bonne découverte…!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction-a-cogugaison">Introduction à COGugaison</a></li>
      <li><a href="#quel-code-officiel-geographique-est-utilise">Quel code officiel géographique est utilisé ?</a></li>
      <li><a href="#quelles-modifications-communales-ont-eu-lieu-entre-deux-dates">Quelles modifications communales ont eu lieu entre deux dates ?</a></li>
      <li><a href="#transformer-des-variables-numeriques-en-autre-geographie">Transformer des variables numériques en autre géographie</a></li>
      <li><a href="#transformer-des-typologies-en-autre-geographie">Transformer des typologies en autre géographie</a></li>
      <li><a href="#agreger-des-tables-de-donnees-communales-a-des-echelons-supra-communaux">Agréger des tables de données communales à des échelons supra-communaux</a></li>
      <li><a href="#enlever-les-arrondissements-municipaux-des-tables-de-donnees-communales">Enlever les arrondissements municipaux des tables de données communales</a></li>
      <li><a href="#jongler-avec-les-differentes-possibilites-pour-les-codes-communaux-corses">Jongler avec les différentes possibilités pour les codes communaux corses</a></li>
      <li><a href="#transformer-des-variables-numeriques-en-autre-geographie-dans-des-donnees-de-flux">Transformer des variables numériques en autre géographie dans des données de flux</a></li>
      <li><a href="#inserer-dans-des-tables-de-donnees-de-flux-communales-des-echelons-supra-communaux">Insérer dans des tables de données de flux communales des échelons supra-communaux</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by  antuki.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
