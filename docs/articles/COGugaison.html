<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Apprendre les principales fonctionnalités de COGugaison â€¢ COGugaison</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Apprendre les principales fonctionnalités de COGugaison">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">COGugaison</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/COGugaison.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://github.com/antuki/COGugaison">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="COGugaison_files/htmlwidgets-0.9/htmlwidgets.js"></script><link href="COGugaison_files/vis-4.20.0/vis.css" rel="stylesheet">
<script src="COGugaison_files/vis-4.20.0/vis.min.js"></script><script src="COGugaison_files/visNetwork-binding-2.0.1/visNetwork.js"></script><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Apprendre les principales fonctionnalités de COGugaison</h1>
                        <h4 class="author">antuki</h4>
            
          </div>

    
    
<div class="contents">
<div id="introduction-a-cogugaison" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-a-cogugaison" class="anchor"></a>Introduction à COGugaison</h2>
<p>Nous allons balayer dans cette vignette les principales fonctionnalités du package <code>COGugaison</code>.</p>
<p>Le découpage des territoires français, en particulier les communes, n’est pas un phénomène immuable. Chaque année certaines communes changent de codes, ou bien de nom, fusionnent ou encore se divisent. Certains périmètres supra-communaux changent également, comme celui des cantons qui a été récemment redéfini. C’est à l’Insee que revient le suivi de ces changements afin d’établir chaque année le code officiel géographique (COG).</p>
<p>Ce package R a alors pour objectif global de manipuler des données communales produites à différents millésimes et de les agréger à différents niveaux supra-communaux. Plus précisément, il permet actuellement de :</p>
<ul>
<li>détecter le millésime du code officiel géographique d’une table de données communales : fonction <code>COG_akinator</code> et apparier une liste de communes d’une base de données avec celle du COG d’un millésime donné avec <code>apparier_COG</code>
</li>
<li>visualiser les modifications communales (fusions, défusions, changements de codes ou de noms) qui ont eu lieu entre deux dates : <code>modifications_communales</code>
</li>
<li>visualiser sur un graphique interactif la trajectoire d’une commune donnée, c’est-à-dire toutes les modifications qui ont eu lieu depuis 1968 : <code>trajectoire_commune</code> et <code>trajectoire_commune_shiny</code><br>
</li>
<li>transformer des tables de données numériques en géographie au premier janvier d’une année souhaitée : <code>changement_COG_varNum</code>.</li>
<li>transformer des typologies de communes en géographie au premier janvier d’une année souhaitée en ayant le choix entre plusieurs hypothèses de classement en cas de fusion de communes de classes différentes (attribuer une unique classe à toutes les communes fusionnées, attribuer la classe qui contient le plus de population, définir une classe absorbante, une classe absorbée ou une classe spécifique aux regroupements de plusieurs communes de classes différentes) : <code>changement_COG_typo</code>. Il est également possible d’isoler dans une table les communes fusionnées appartenant à des classes différentes : <code>changement_COG_typo_details</code>.</li>
<li>permettre d’agréger les tables de données communales à de nombreux échelons supra-communaux administratifs (EPCI, arrondissements, cantons-villes, départements, régions) ou d’étude (bassins de vie, zones d’emploi, unités urbaines, aires urbaines) : <code>nivsupra</code>.</li>
<li>gérer des cas particuliers comme les codes Insee des communes corses (<code>modification_Corse</code>) ou des arrondissements municipaux de Paris, Lyon, et Marseille (<code>enlever_PLM</code>) ou encore l’ancienne commune de l’Oudon (<code>modification_Oudon</code>)</li>
</ul>
<p>Il est à noter que la version actuellement en ligne du package correspond à un premier développement qui comporte des imperfections. L’idée est donc à ce stade que les personnes qui utilisent régulièrement des bases de données communales produites à différents millésimes testent ses fonctionnalités, détectent ses bugs et ses manques pour l’améliorer.</p>
<p>Il est également important de souligner que les données utilisées ici s’appuient sur des tables publiées par l’Insee :</p>
<ul>
<li><a href="https://www.insee.fr/fr/information/2666684#titre-bloc-11">l’historique des géographies communales</a></li>
<li><a href="https://www.insee.fr/fr/information/2028028">les tables d’appartenance des communes aux différents niveaux géographiques</a></li>
</ul>
<p>Tant que le package n’est pas stabilisé, il est évidemment conseillé de se référer aux données officielles de l’Insee en cas de doute sur un résultat.</p>
<p>Commençons par installer le package <code>COGugaison</code> et à le charger dans R.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#devtools::install_github("antuki/COGugaison")</span>
<span class="kw">library</span>(COGugaison)</code></pre></div>
</div>
<div id="les-bases-de-donnees-utiles-dans-cogugaison" class="section level2">
<h2 class="hasAnchor">
<a href="#les-bases-de-donnees-utiles-dans-cogugaison" class="anchor"></a>Les bases de données utiles dans COGugaison</h2>
<p>En plus de contenir des fonctions permettant la gestion des codes officiels géographiques, COGugaison contient également, dans des Rdata, des bases de données qui peuvent vous être également utiles par ailleurs.</p>
<blockquote>
<ul>
<li>COG</li>
</ul>
</blockquote>
<p>Ce Rdata contient des data.frame (tables de données) intitulés COGXXXX, XXXX étant à remplacer par une année de COG donnée. Les tables intitulées COGXXXX_insee correspondent à des tables selon le COG pris en compte par l’Insee dans la diffusion de ses données (qui est presque identique au COG à quelques exceptions près listées dans la documentations).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(COG2017)</code></pre></div>
<pre><code>##   CODGEO                  LIBGEO   POP
## 1  01001 L'Abergement-Clémenciat   767
## 2  01002   L'Abergement-de-Varey   239
## 3  01004       Ambérieu-en-Bugey 14022
## 4  01005     Ambérieux-en-Dombes  1627
## 5  01006                 Ambléon   109
## 6  01007                Ambronay  2570</code></pre>
<p>Les variables des tables sont les suivantes :</p>
<ul>
<li>CODGEO contient le code Insee des communes</li>
<li>LIBGEO contient le nom des communes</li>
<li>POP contient la population de référence de la commune selon l’année du COG</li>
</ul>
<blockquote>
<ul>
<li>TABLES_PASSAGE</li>
</ul>
</blockquote>
<p>Ce Rdata contient des data.frame intitulées PASSAGE_XXXX_YYYY, XXXX et YYYY étant à remplacer par des années de COG données. Il s’agit de tables de passages permettant de passer d’un COG à un autre (plus récent ou plus ancien). Le suffixe “_insee" correspond également à des tables qui tiennent compte des COG pris en compte par l’Insee.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(PASSAGE_2015_2016_insee)</code></pre></div>
<pre><code>##   cod2015 cod2016      annee typemodif ratio
## 1   14697   14472 2016-01-01         c     1
## 2   01015   01015 2016-01-01         f     1
## 3   01340   01015 2016-01-01         f     1
## 4   01080   01080 2016-01-01         f     1
## 5   01119   01080 2016-01-01         f     1
## 6   01176   01187 2016-01-01         f     1</code></pre>
<p>Les variables des tables sont les suivantes :</p>
<ul>
<li>codXXXX : code Insee de la commune de départ</li>
<li>codYYYY : code Insee de la commune d’arrivée</li>
<li>annee : année de la modification</li>
<li>typemodif : type de modification communale (f = fusion, d = défusion, c= changement de code).</li>
<li>ratio : poids de répartition des effectifs en cas de défusion (vaut 1 sinon). Ce poids est proportionnel à la population des communes défusionnées.</li>
</ul>
<blockquote>
<ul>
<li>DATA_SUPRACOM</li>
</ul>
</blockquote>
<p>Ce Rdata contient, pour chaque année depuis 2014, deux data.frame intitulées table_supracom_20XX et libelles_supracom_20XX qui correspondent aux <a href="https://www.insee.fr/fr/information/2028028">tables d’appartenance des communes aux différents niveaux géographiques</a> produites par l’Insee (cliquez sur le lien pour voir la documentation sur les variables présentes). La première table associe chaque code communal insee aux niveaux supra-communaux associés (en COG le plus actuel, actuellement 2017) et la seconde indique les libellés de ces différents niveaux supra-communaux.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(table_supracom_2017)</code></pre></div>
<pre><code>##   CODGEO                  LIBGEO DEP REG      EPCI NATURE_EPCI ARR   CV
## 1  01001 L'Abergement-Clémenciat  01  84 200069193          CC 012 0108
## 2  01002   L'Abergement-de-Varey  01  84 240100883          CC 011 0101
## 3  01004       Ambérieu-en-Bugey  01  84 240100883          CC 011 0101
## 4  01005     Ambérieux-en-Dombes  01  84 200042497          CC 012 0122
## 5  01006                 Ambléon  01  84 200040350          CC 011 0104
## 6  01007                Ambronay  01  84 240100883          CC 011 0101
##   ZE2010 UU2010 TUU2014 TDUU2014 AU2010 TAU2014 CATAEU2010 BV2012
## 1   8213  01000       0       05    997      00        120  01093
## 2   8201  01000       0       04    002      09        112  01004
## 3   8201  01302       3       32    002      09        112  01004
## 4   8213  01000       0       06    002      09        112  69123
## 5   8216  01000       0       03    998      00        300  01034
## 6   8201  01000       0       07    002      09        112  01004</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(libelles_supracom_2017)</code></pre></div>
<pre><code>##   NIVGEO CODGEO          LIBGEO NB_COM
## 1    ARR    011          Belley    115
## 2    ARR    012 Bourg-en-Bresse    201
## 3    ARR    013             Gex     27
## 4    ARR    014          Nantua     65
## 5    ARR    021 Château-Thierry    108
## 6    ARR    022            Laon    244</code></pre>
<blockquote>
<ul>
<li>HISTORIQ_MODIF_COM</li>
</ul>
</blockquote>
<p>Ce Rdata contient un data.frame intitulé historiq qui correspond à <a href="https://www.insee.fr/fr/information/2666684#titre-bloc-11">l’historique des géographies communales</a> produit par l’Insee (cliquez sur le lien pour voir la documentation sur les variables présentes). A terme, cette base de données pourrait être remplacée par celle de <a href="https://github.com/etalab/geohisto">geohisto</a> sur laquelle travaille actuellement Etalab.</p>
</div>
<div id="quel-code-officiel-geographique-est-utilise" class="section level2">
<h2 class="hasAnchor">
<a href="#quel-code-officiel-geographique-est-utilise" class="anchor"></a>Quel code officiel géographique est utilisé ?</h2>
<p>Nous allons maintenant manipuler une table exemple incluse dans le package, la table <code>exemple_popcom</code> qui contient comme variables le code géographique de la commune (CODGEO), son nom (LIBGEO), sa population en 2012 (P12_POP), sa superficie (SUPERF) ainsi que deux typologies de territoires générées aléatoirement (typoA et typoB). Il faut veiller à ce que les variables numériques soient au bon format dans R et que les typologies et identifiants soient au format caractère (si ce n’est pas le cas, il faudra les transformer avec les fonctions <em>as.numeric</em> et <em>as.character</em>).s</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(exemple_popcom)</code></pre></div>
<pre><code>##   CODGEO                  LIBGEO P12_POP SUPERF    typoA typoB
## 1  01001 L'Abergement-Clémenciat     777     16 CLASSE 2     F
## 2  01002   L'Abergement-de-Varey     235      9 CLASSE 3     D
## 3  01004       Ambérieu-en-Bugey   14233     25 CLASSE 1     B
## 4  01005     Ambérieux-en-Dombes    1642     16 CLASSE 3     F
## 5  01006                 Ambléon     110      6 CLASSE 4     E
## 6  01007                Ambronay    2437     34 CLASSE 5     A</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">str</span>(exemple_popcom)</code></pre></div>
<pre><code>## 'data.frame':    36664 obs. of  6 variables:
##  $ CODGEO : chr  "01001" "01002" "01004" "01005" ...
##  $ LIBGEO : chr  "L'Abergement-Clémenciat" "L'Abergement-de-Varey" "Ambérieu-en-Bugey" "Ambérieux-en-Dombes" ...
##  $ P12_POP: int  777 235 14233 1642 110 2437 739 338 1069 385 ...
##  $ SUPERF : int  16 9 25 16 6 34 5 7 29 15 ...
##  $ typoA  : chr  "CLASSE 2" "CLASSE 3" "CLASSE 1" "CLASSE 3" ...
##  $ typoB  : chr  "F" "D" "B" "F" ...
##  - attr(*, "spec")=List of 2
##   ..$ cols   :List of 6
##   .. ..$ CODGEO : list()
##   .. .. ..- attr(*, "class")= chr  "collector_character" "collector"
##   .. ..$ LIBGEO : list()
##   .. .. ..- attr(*, "class")= chr  "collector_character" "collector"
##   .. ..$ P12_POP: list()
##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
##   .. ..$ SUPERF : list()
##   .. .. ..- attr(*, "class")= chr  "collector_integer" "collector"
##   .. ..$ typoA  : list()
##   .. .. ..- attr(*, "class")= chr  "collector_character" "collector"
##   .. ..$ typoB  : list()
##   .. .. ..- attr(*, "class")= chr  "collector_character" "collector"
##   ..$ default: list()
##   .. ..- attr(*, "class")= chr  "collector_guess" "collector"
##   ..- attr(*, "class")= chr "col_spec"</code></pre>
<p>La fonction <code>COG_akinator</code> permet de donner des pistes à l’utilisateur sur le code officiel géographique (COG) utilisé dans sa table de données communales, c’est-à-dire de savoir si la liste de communes utilisée correspond à la liste officiel au premier janvier de 2017 ? de 2016 ? ou d’une autre année.</p>
<p>Le paramètre <em>donnees_insee</em> vaut TRUE si les données manipulées sont produites par l’Insee. En effet, quelques rares modifications communales (la défusion des communes Loisey et Culey au 1er janvier 2014 par exemple) ont été prises en compte dans les bases de données communales de l’Insee plus tard que la date officielle (se référer à la documentation de la fonction pour plus de précisions).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/COG_akinator.html">COG_akinator</a></span>(<span class="dt">vecteur_codgeo=</span>exemple_popcom[,<span class="dv">1</span>],<span class="dt">donnees_insee=</span>T)</code></pre></div>
<pre><code>## [1] "COG2014"</code></pre>
<p>En l’occurrence la liste de communes utilisée dans cette table correspond à la liste des communes au 1er janvier 2014.</p>
<p>Une fois que le COG d’une base de données est détecté, ou bien si justement le COG n’arrive pas à être détecté par la fonction <code>COG_akinator</code>, il est possible d’utiliser la fonction <code>apparier_COG</code> pour comparer la liste des communes présente dans une table de données avec le COG d’un millésime donné.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/COG_akinator.html">COG_akinator</a></span>(exemple_popcom$CODGEO,<span class="dt">donnees_insee =</span> T)</code></pre></div>
<pre><code>## [1] "COG2014"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/apparier_COG.html">apparier_COG</a></span>(<span class="dt">vecteur_codgeo=</span><span class="kw">c</span>(exemple_popcom[<span class="kw">which</span>(exemple_popcom$CODGEO!=<span class="st">"01001"</span>),<span class="dv">1</span>],<span class="st">"XXXXX"</span>), <span class="dt">donnees_insee =</span> T,<span class="dt">COG=</span><span class="dv">2014</span>)</code></pre></div>
<pre><code>## $absent_de_bdd
##  [1] "01001" "97601" "97602" "97603" "97604" "97605" "97606" "97607"
##  [9] "97608" "97609" "97610" "97611" "97612" "97613" "97614" "97615"
## [17] "97616" "97617"
## 
## $absent_de_COG
## [1] "XXXXX"</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">appariement &lt;-<span class="st"> </span><span class="kw"><a href="../reference/apparier_COG.html">apparier_COG</a></span>(<span class="dt">vecteur_codgeo=</span><span class="kw">c</span>(exemple_popcom[<span class="kw">which</span>(exemple_popcom$CODGEO!=<span class="st">"01001"</span>),<span class="dv">1</span>],<span class="st">"XXXXX"</span>), <span class="dt">donnees_insee =</span> T,<span class="dt">COG=</span><span class="dv">2014</span>)
<span class="kw">cat</span>(appariement$absent_de_bdd)</code></pre></div>
<pre><code>## 01001 97601 97602 97603 97604 97605 97606 97607 97608 97609 97610 97611 97612 97613 97614 97615 97616 97617</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(appariement$absent_de_COG)</code></pre></div>
<pre><code>## XXXXX</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># regarder le libellé des communes présentes dans le COG mais pas dans la base de données</span>
COG2014_insee[<span class="kw">which</span>(COG2014_insee$CODGEO%in%appariement$absent_de_bdd),<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>)]</code></pre></div>
<pre><code>##       CODGEO                  LIBGEO
## 1      01001 L'Abergement-Clémenciat
## 36665  97601                   Acoua
## 36666  97602              Bandraboua
## 36667  97603                Bandrélé
## 36668  97604                  Bouéni
## 36669  97605                 Chiconi
## 36670  97606               Chirongui
## 36671  97607                 Dembeni
## 36672  97608                Dzaoudzi
## 36673  97609                KaniKéli
## 36674  97610                 Koungou
## 36675  97611               Mamoudzou
## 36676  97612               Mtzamboro
## 36677  97613            Mtsangamouji
## 36678  97614                Ouangani
## 36679  97615                Pamandzi
## 36680  97616                    Sada
## 36681  97617                Tsingoni</code></pre>
</div>
<div id="visualiser-les-modifications-communales" class="section level2">
<h2 class="hasAnchor">
<a href="#visualiser-les-modifications-communales" class="anchor"></a>Visualiser les modifications communales</h2>
<p>La fonction <code>trajectoire_commune</code> permet d’observer sur un diagramme interactif la trajectoire d’une commune depuis 1968 (aucun changement, fusions, défusions ou changements de codes).</p>
<p>Le paramètre <em>codgeo</em> est une chaîne de 5 caractères qui indique le code Insee de la commune considérée et le paramètre <em>COG</em> indique l’année de COG de la communes considérée.</p>
<p>La fonction <code>trajectoire_commune_shiny</code> lance une application shiny qui permet de sélectionner la commune pour laquelle vous souhaitez observer ses modifications depuis 1968.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Ici, nous allons observer sur un graphique interactif la trajectoire de la commune ayant pour code 01003 en 1968 (fusion avec 2 autres communes le 1er janvier 1974)</span>
<span class="kw"><a href="../reference/trajectoire_commune.html">trajectoire_commune</a></span>(<span class="st">"01003"</span>, <span class="dv">1968</span>,<span class="dt">donnees_insee=</span>F)</code></pre></div>
<pre><code>## 
## Attachement du package : 'dplyr'</code></pre>
<pre><code>## The following objects are masked from 'package:stats':
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union</code></pre>
<div id="htmlwidget-6192bec42648b1cac78e" style="width:100%;height:500px;" class="visNetwork html-widget"></div>
<script type="application/json" data-for="htmlwidget-6192bec42648b1cac78e">{"x":{"nodes":{"id":["01003_1968","01070_1968","01165_1968","01165_1975","01165_2017"],"comm":["01003","01070","01165","01165","01165"],"COG":["1968","1968","1968","1975","2017"],"label":["01003\n(1968)","01070\n(1968)","01165\n(1968)","01165\n(1975)","01165\n(2017)"],"level":[1,1,1,2,3],"pop":["140","100","128","470","1515"],"libgeo":["AMAREINS","CESSEINS","FRANCHELEINS","FRANCHELEINS","Francheleins"],"ratio":[1,1,1,1,1],"title":["<b><a target=\"_blank\" href=https://www.insee.fr/fr/recherche/recherche-geographique?geo=COM-01003&debut=0>01003<\/a> AMAREINS<\/b><br>Population : 140 hab.","<b><a target=\"_blank\" href=https://www.insee.fr/fr/recherche/recherche-geographique?geo=COM-01070&debut=0>01070<\/a> CESSEINS<\/b><br>Population : 100 hab.","<b><a target=\"_blank\" href=https://www.insee.fr/fr/recherche/recherche-geographique?geo=COM-01165&debut=0>01165<\/a> FRANCHELEINS<\/b><br>Population : 128 hab.","<b><a target=\"_blank\" href=https://www.insee.fr/fr/recherche/recherche-geographique?geo=COM-01165&debut=0>01165<\/a> FRANCHELEINS<\/b><br>Population : 470 hab.","<b><a target=\"_blank\" href=https://www.insee.fr/fr/recherche/recherche-geographique?geo=COM-01165&debut=0>01165<\/a> Francheleins<\/b><br>Population : 1515 hab."]},"edges":{"from":["01003_1968","01070_1968","01165_1968","01165_1975"],"to":["01165_1975","01165_1975","01165_1975","01165_2017"],"LIBGEO":["AMAREINS","CESSEINS","FRANCHELEINS",null],"POP":[140,100,128,null],"annee":["1974-01-01","1974-01-01","1974-01-01",null],"typemodif":["f","f","f",null],"ratio":[1,1,1,1],"arrows.middle.enabled":[true,true,true,false],"dashes":[false,false,false,true],"value":[1,1,1,0.2],"title":["<b>fusion<\/b><br>Date : 01 janv. 1974<br>","<b>fusion<\/b><br>Date : 01 janv. 1974<br>","<b>fusion<\/b><br>Date : 01 janv. 1974<br>",null]},"nodesToDataframe":true,"edgesToDataframe":true,"options":{"width":"100%","height":"100%","nodes":{"shape":"ellipse","color":{"border":"black","background":"#000000","highlight":{"border":"#000000","background":"#000000"}},"fixed":{"allowedToMoveX":true,"allowedToMoveY":true},"font":{"face":"verdana","color":"#FFFFFF","size":20}},"manipulation":{"enabled":false},"edges":{"width":10,"arrows":{"middle":{"enabled":true,"scaleFactor":3}},"color":{"color":"#2AA198"},"shadow":false},"layout":{"hierarchical":{"enabled":true,"levelSeparation":500,"direction":"LR"},"randomSeed":12},"interaction":{"hoverConnectedEdges":false,"navigationButtons":true,"selectable":false,"selectConnectedEdges":false},"physics":{"hierarchicalRepulsion":{"centralGravity":0,"springConstant":0,"nodeDistance":0}},"configure":{"enabled":false}},"groups":null,"width":"100%","height":"500px","idselection":{"enabled":false},"byselection":{"enabled":false},"main":null,"submain":null,"footer":null,"tooltipStay":300,"tooltipStyle":"position: fixed;visibility:hidden;padding: 5px;white-space: nowrap;font-family: verdana;font-size:14px;font-color:#000000;background-color: #f5f4ed;-moz-border-radius: 3px;-webkit-border-radius: 3px;border-radius: 3px;border: 1px solid #808074;box-shadow: 3px 3px 10px rgba(0, 0, 0, 0.2);"},"evals":[],"jsHooks":[]}</script><div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Cette fonction lance une application shiny permettant d'observer toutes les trajectoires des communes.</span>
<span class="co">#trajectoire_commune_shiny()</span></code></pre></div>
<p>La fonction <code>modifications_communales</code> permet, comme son nom l’indique, de visualiser les modifications communales (fusions, défusions, changements de codes ou de noms) qui ont eu lieu entre deux dates. Ici entre le 01/01/2014 et le 01/01/2015. Cette fonction est encore en cours de développement il est donc possible que certains évènements ne soient pas encore pris en compte. Il ne faut pas hésiter à le signaler.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">modifs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/modifications_communales.html">modifications_communales</a></span>(<span class="dt">date_debut=</span><span class="st">"01-01-2014"</span>,<span class="dt">date_fin=</span><span class="st">"01-01-2015"</span>)
<span class="kw">cat</span>(modifs$fusions)</code></pre></div>
<pre><code>## 2015-01-01 : Notre-Dame-d'Estrées-Corbon (14474) est un rassemblement de Corbon (14178), Notre-Dame-d'Estrées (14474) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Auxons (25035) est un rassemblement de Auxon-Dessous (25034), Auxon-Dessus (25035) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Goussainville (28185) est un rassemblement de Champagne (28069), Goussainville (28185) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Eclose-Badinières (38152) est un rassemblement de Badinières (38024), Eclose (38152) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Saint-Crépin-Ibouvillers (60570) est un rassemblement de Montherlant (60417), Saint-Crépin-Ibouvillers (60570) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Montsecret-Clairefougère (61292) est un rassemblement de Clairefougère (61109), Montsecret (61292) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Boischampré (61375) est un rassemblement de Marcei (61249), Saint-Christophe-le-Jajolet (61375), Saint-Loyer-des-Champs (61417), Vrigny (61511) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Tinchebray-Bocage (61486) est un rassemblement de Beauchêne (61031), Frênes (61177), Larchamp (61223), Saint-Cornier-des-Landes (61377), Saint-Jean-des-Bois (61410), Tinchebray (61486), Yvrandes (61513) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Vaugneray (69255) est un rassemblement de Saint-Laurent-de-Vaux (69221), Vaugneray (69255) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Clux-Villeneuve (71578) est un rassemblement de Clux (71138), Villeneuve (71578) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Villeneuve-en-Perseigne (72137) est un rassemblement de Chassé (72069), Fresnaye-sur-Chédouet (72137), Lignières-la-Carelle (72162), Montigny (72207), Roullée (72258), Saint-Rigomer-des-Bois (72318) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Saint-Offenge (73263) est un rassemblement de Saint-Offenge-Dessous (73263), Saint-Offenge-Dessus (73264) [commune nouvelle avec commune(s) déléguée(s)].
## 2015-01-01 : Orvanne (77316) est un rassemblement de Écuelles (77166), Moret-sur-Loing (77316) [commune nouvelle avec commune(s) déléguée(s)].</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(modifs$defusions)</code></pre></div>
<pre><code>## ATTENTION, l'évènement suivant a été pris en compte dans les données de l'Insee seulement au 01/01/2015 : 2014-01-01 : Loisey (55298) s'est séparée en Loisey (55298), Culey (55138) [rétablissement].</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(modifs$changements_codes)</code></pre></div>
<pre><code>## 2014-01-07 : Le code commune de Oudon passe de 14697 à 14472 [changement de code dû à un changement de chef-lieu].</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cat</span>(modifs$changements_noms)</code></pre></div>
<pre><code>## 2014-12-06 : La commune de Barisis (02049) change de nom en Barisis-aux-Bois [changement de nom].
## 2014-12-06 : La commune de Sainte-Colombe (21544) change de nom en Sainte-Colombe-en-Auxois [changement de nom].
## 2014-12-06 : La commune de Pont-de-Roide (25463) change de nom en Pont-de-Roide-Vermondans [changement de nom].
## 2014-12-06 : La commune de Cazaril-Laspènes (31129) change de nom en Cazarilh-Laspènes [changement de nom].
## 2014-12-06 : La commune de Saint-Martin (66184) change de nom en Saint-Martin-de-Fenouillet [changement de nom].
## 2014-12-06 : La commune de Cré (72108) change de nom en Cré-sur-Loir [changement de nom].
## 2014-12-06 : La commune de Belbèse (82015) change de nom en Belbèze-en-Lomagne [changement de nom].
## 2014-12-06 : La commune de Saint-Vincent (82174) change de nom en Saint-Vincent-d'Autéjac [changement de nom].</code></pre>
</div>
<div id="transformer-des-variables-numeriques-en-autre-geographie" class="section level2">
<h2 class="hasAnchor">
<a href="#transformer-des-variables-numeriques-en-autre-geographie" class="anchor"></a>Transformer des variables numériques en autre géographie</h2>
<p>La fonction <code>changement_COG_varNum</code> permet de transformer des tables de données numériques communales en géographie au premier janvier d’une année souhaitée.</p>
<p>Ici, nous allons transformer les variables numériques de la table <em>exemple_pop</em> afin de récupérer les données de population et de superficie des communes au 1er janvier 2017 (au lieu de 2014).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_popcom_COG2017_num &lt;-<span class="st"> </span><span class="kw"><a href="../reference/changement_COG_varNum.html">changement_COG_varNum</a></span>(<span class="dt">table_entree=</span>exemple_popcom,<span class="dt">annees=</span><span class="kw">c</span>(<span class="dv">2014</span>:<span class="dv">2017</span>),<span class="dt">agregation=</span>T,<span class="dt">libgeo=</span>T,<span class="dt">donnees_insee=</span>T)
<span class="kw">head</span>(exemple_popcom_COG2017_num)</code></pre></div>
<pre><code>##   CODGEO             nom_commune P12_POP SUPERF
## 1  01001 L'Abergement-Clémenciat     777     16
## 2  01002   L'Abergement-de-Varey     235      9
## 3  01004       Ambérieu-en-Bugey   14233     25
## 4  01005     Ambérieux-en-Dombes    1642     16
## 5  01006                 Ambléon     110      6
## 6  01007                Ambronay    2437     34</code></pre>
<p>Le paramètre <em>agregation</em> vaut TRUE si la table souhaitée doit sommer toutes les lignes qui concernent une même commune et FALSE si l’on souhaite volontairement conserver les doublons dans les codes commune (dans les tables de flux par exemple, cf. plus bas). Le paramètre <em>libgeo</em> vaut TRUE si l’on veut rajouter dans la table une colonne nommée “nom_commune” qui indique le nom de la commune issu du code officiel géographique et FALSE sinon.</p>
</div>
<div id="transformer-des-typologies-en-autre-geographie" class="section level2">
<h2 class="hasAnchor">
<a href="#transformer-des-typologies-en-autre-geographie" class="anchor"></a>Transformer des typologies en autre géographie</h2>
<p>La fonction <code>changement_COG_typo</code> permet de transformer des typologies de communes en géographie au premier janvier d’une année souhaitée. Ici nous allons transformer les deux typologies (typoA et typoB) de la table <em>exemple_pop</em> en géographie communale au 1er janvier 2017 (au lieu de 2014).</p>
<p>Ici, l’hypothèse de classement en cas de fusion de communes (<em>methode_fusion</em>) choisie est celle d’une classe spécifique (<em>methode_difference</em>, classe appelée <em>mot_difference</em>=“differents”) aux regroupements de plusieurs communes de classes différentes. Les autres hypothèses possibles auraient pu être l’hypothèse du maximum de population <em>methode_max_pop</em>, de classe absorbée <em>methode_classe_absorbee</em>, de classe absorbante <em>methode_classe_absorbante</em> ou d’indiquer un nom de classe spécifique pour toutes les communes qui ont fusionnées : <em>methode_classe_fusion</em>. Pour plus de détails, référez-vous à ?changement_COG_typo.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_popcom_COG2017_typo &lt;-<span class="st"> </span><span class="kw"><a href="../reference/changement_COG_typo.html">changement_COG_typo</a></span>(<span class="dt">table_entree=</span>exemple_popcom[,-<span class="dv">2</span>],<span class="dt">annees=</span><span class="kw">c</span>(<span class="dv">2014</span>:<span class="dv">2017</span>),<span class="dt">methode_fusion=</span><span class="st">"methode_difference"</span>,<span class="dt">typos=</span><span class="kw">c</span>(<span class="st">"typoA"</span>,<span class="st">"typoB"</span>),<span class="dt">mot_difference =</span> <span class="st">"differents"</span>,<span class="dt">libgeo=</span>T,<span class="dt">donnees_insee=</span>T)
<span class="kw">head</span>(exemple_popcom_COG2017_typo)</code></pre></div>
<pre><code>##   CODGEO             nom_commune    typoA typoB
## 1  01001 L'Abergement-Clémenciat CLASSE 2     F
## 2  01002   L'Abergement-de-Varey CLASSE 3     D
## 3  01004       Ambérieu-en-Bugey CLASSE 1     B
## 4  01005     Ambérieux-en-Dombes CLASSE 3     F
## 5  01006                 Ambléon CLASSE 4     E
## 6  01007                Ambronay CLASSE 5     A</code></pre>
<p>La fonction <code>changement_COG_typo_details</code> permet quant à elle d’isoler dans une table les communes fusionnées appartenant à des classes différentes, ici selon la typologie “typoA” entre 2014 et 2015 puis 2015 et 2016 et 2016 et 2017.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">details_exemple_popcom_COG2017_typo &lt;-<span class="st"> </span><span class="kw"><a href="../reference/changement_COG_typo_details.html">changement_COG_typo_details</a></span>(<span class="dt">table_entree=</span>exemple_popcom[,-<span class="dv">2</span>],<span class="dt">annees=</span><span class="kw">c</span>(<span class="dv">2014</span>:<span class="dv">2017</span>),<span class="dt">typo=</span><span class="st">"typoA"</span>, <span class="dt">donnees_insee=</span>T)
<span class="kw">head</span>(details_exemple_popcom_COG2017_typo[[<span class="st">"2014_2015"</span>]])</code></pre></div>
<pre><code>##   cod2014              lib2014 cod2015                     lib2015
## 1   14178               Corbon   14474 Notre-Dame-d'Estrées-Corbon
## 2   14474 Notre-Dame-d'Estrées   14474 Notre-Dame-d'Estrées-Corbon
## 3   25034        Auxon-Dessous   25035                  Les Auxons
## 4   25035         Auxon-Dessus   25035                  Les Auxons
## 5   38024           Badinières   38152           Eclose-Badinières
## 6   38152               Eclose   38152           Eclose-Badinières
##      typoA
## 1 CLASSE 2
## 2 CLASSE 4
## 3 CLASSE 1
## 4 CLASSE 3
## 5 CLASSE 4
## 6 CLASSE 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(details_exemple_popcom_COG2017_typo[[<span class="st">"2015_2016"</span>]])</code></pre></div>
<pre><code>##   cod2015             lib2015 cod2016            lib2016    typoA
## 1   01015           Arbignieu   01015    Arboys en Bugey CLASSE 3
## 2   01340          Saint-Bois   01015    Arboys en Bugey CLASSE 2
## 3   01119           Corcelles   01080 Champdor-Corcelles CLASSE 1
## 4   01080            Champdor   01080 Champdor-Corcelles CLASSE 2
## 5   01176 Le Grand-Abergement   01187      Haut Valromey CLASSE 2
## 6   01409             Songieu   01187      Haut Valromey CLASSE 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(details_exemple_popcom_COG2017_typo[[<span class="st">"2016_2017"</span>]])</code></pre></div>
<pre><code>##   cod2016             lib2016 cod2017          lib2017    typoA
## 1   01095 Chavannes-sur-Suran   01095 Nivigne et Suran CLASSE 5
## 2   01172           Germagnat   01095 Nivigne et Suran CLASSE 1
## 3   01098         Chazey-Bons   01098      Chazey-Bons CLASSE 3
## 4   01316              Pugieu   01098      Chazey-Bons CLASSE 4
## 5   03168             Meaulne   03168   Meaulne-Vitray CLASSE 2
## 6   03318              Vitray   03168   Meaulne-Vitray CLASSE 5</code></pre>
</div>
<div id="agreger-des-tables-de-donnees-communales-a-des-echelons-supra-communaux" class="section level2">
<h2 class="hasAnchor">
<a href="#agreger-des-tables-de-donnees-communales-a-des-echelons-supra-communaux" class="anchor"></a>Agréger des tables de données communales à des échelons supra-communaux</h2>
<p>La fonction <code>nivsupra</code> permet d’agréger les tables de données communales à de nombreux échelons supra-communaux administratifs (EPCI, arrondissements, cantons-villes, départements, régions) ou d’étude (bassins de vie, zones d’emploi, unités urbaines, aires urbaines) en indiquant le COG de la base de donnée en entrée et de référence des niveaux supra-communaux grâce au paramètre <em>COG</em> (par défaut renvoie le COG renvoyé par <code>COG_akinator</code>). Le paramètre <em>COG</em> peut prendre les valeurs 2008 à l’année de COG la plus récente (2017).</p>
<p>Ici nous agrégeons la population et la superficie des communes à l’échelon géographique des zones d’emploi afin d’obtenir une table des densités de population par zone d’emploi.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_popcom_COG2017 &lt;-<span class="st"> </span><span class="kw">merge</span>(exemple_popcom_COG2017_num,exemple_popcom_COG2017_typo[,-<span class="dv">2</span>],<span class="dt">by=</span><span class="st">"CODGEO"</span>,<span class="dt">all=</span>T)
exemple_popcom_ZE2010 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nivsupra.html">nivsupra</a></span>(<span class="dt">table_entree=</span>exemple_popcom_COG2017,<span class="dt">nivsupra=</span><span class="st">"ZE2010"</span>,<span class="dt">agregation=</span>T,<span class="dt">COG=</span><span class="dv">2017</span>)
exemple_popcom_ZE2010$densite &lt;-<span class="st"> </span>exemple_popcom_ZE2010$P12_POP /<span class="st"> </span>exemple_popcom_ZE2010$SUPERF
<span class="kw">head</span>(exemple_popcom_ZE2010)</code></pre></div>
<pre><code>##   ZE2010                         LIBGEO P12_POP SUPERF  densite
## 1   0050                 Mont-de-Marsan  160717   4956 32.42877
## 2   0051                        Alençon  122263   2405 50.83701
## 3   0052                Cosne - Clamecy   75052   2553 29.39757
## 4   0053                          Mâcon  143358   1543 92.90862
## 5   0054               Nogent-le-Rotrou   48665   1227 39.66178
## 6   0055 La Vallée de la Bresle - Vimeu   99095   1134 87.38536</code></pre>
</div>
<div id="gerer-des-cas-particuliers-dans-les-bases-de-donnees" class="section level2">
<h2 class="hasAnchor">
<a href="#gerer-des-cas-particuliers-dans-les-bases-de-donnees" class="anchor"></a>Gérer des cas particuliers dans les bases de données</h2>
<div id="enlever-les-arrondissements-municipaux-des-tables-de-donnees-communales" class="section level3">
<h3 class="hasAnchor">
<a href="#enlever-les-arrondissements-municipaux-des-tables-de-donnees-communales" class="anchor"></a>Enlever les arrondissements municipaux des tables de données communales</h3>
<p>Nous allons maintenant manipuler une autre table exemple incluse dans le package, la table <code>exemple_flux</code> qui contient des exemples de flux entre une communes de résidences (COMMUNE) et de travail (DCLT). Elle contient comme autres variables le code de la catégorie socio-professionnelle des individus (CS1), la catégorie d’âge (AGEREVQ) et le poids de l’individu statistique (IPONDI).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(exemple_flux)</code></pre></div>
<pre><code>##   COMMUNE  DCLT CS1 AGEREVQ IPONDI
## 1   55298 45055   5      25      4
## 2   55298 52448   3      50      4
## 3   55298 54323   5      55      4
## 4   55298 55010   6      35      4
## 5   55298 55029   6      20      4
## 6   55298 55029   6      40      4</code></pre>
<p>La fonction <code>enlever_PLM</code> permet de remplacer les codes Insee des arrondissements municipaux de Paris, Lyon et Marseille par leurs codes communes respectifs.</p>
<p>Le paramètre <em>vecteur_entree</em> vaut TRUE si l’élément à transformer est un vecteur de codes insee et FALSE s’il s’agit d’une table de données (data.frame) numériques. Attention, cette fonction ne gère pas les conversions de typologies (variables de type caractère).</p>
<p>Ici nous allons remplacer les arrondissement municipaux par les codes communaux dans la table <code>exemple_flux</code> pour les variables COMMUNE puis DCLT.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_flux_sansPLM &lt;-<span class="kw"><a href="../reference/enlever_PLM.html">enlever_PLM</a></span>(<span class="dt">table_entree=</span>exemple_flux,<span class="dt">codgeo_entree =</span> <span class="st">"COMMUNE"</span>,<span class="dt">libgeo=</span><span class="ot">NULL</span>,<span class="dt">agregation =</span> F,<span class="dt">vecteur_entree=</span>F)
exemple_flux_sansPLM &lt;-<span class="kw"><a href="../reference/enlever_PLM.html">enlever_PLM</a></span>(<span class="dt">table_entree=</span>exemple_flux_sansPLM,<span class="dt">codgeo_entree =</span> <span class="st">"DCLT"</span>,<span class="dt">libgeo=</span><span class="ot">NULL</span>,<span class="dt">agregation =</span> F,<span class="dt">vecteur_entree=</span>F)</code></pre></div>
</div>
<div id="jongler-avec-les-differentes-possibilites-pour-les-codes-communaux-corses" class="section level3">
<h3 class="hasAnchor">
<a href="#jongler-avec-les-differentes-possibilites-pour-les-codes-communaux-corses" class="anchor"></a>Jongler avec les différentes possibilités pour les codes communaux corses</h3>
<p>La fonction <code>modification_Corse</code> permet quant à elle de modifier les codes Insee des communes corses. En effet, en 1976, les codes de toutes les communes corses sont modifiés : alors qu’ils commençaient tous par “20”, leurs deux premiers caractères sont remplacés par “2A” (Corse du Sud) ou “2B” (Corse du Nord). Les codes postaux conservent d’ailleurs aujourd’hui le préfixe historique “20”. Cette fonction est notamment utile pour la raison suivante : dans certaines tables issues des recensements Insee de 1968 ou 1975, les communes sont déjà codées avec les préfixes 2A et 2B.</p>
<p>Le paramètre <em>sens</em> vaut “20vers2A2B” pour changer tous les codes communes corses commençant par 20 par 2A ou 2B et vaut “2A2Bvers20” quand l’effet inverse est recherché.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_flux_sansPLMsansCorse &lt;-<span class="st"> </span><span class="kw"><a href="../reference/modification_Corse.html">modification_Corse</a></span>(<span class="dt">table_entree=</span>exemple_flux_sansPLM,<span class="dt">sens=</span><span class="st">"2A2Bvers20"</span>)</code></pre></div>
</div>
<div id="corriger-le-code-commune-de-loudon-dans-le-calvados" class="section level3">
<h3 class="hasAnchor">
<a href="#corriger-le-code-commune-de-loudon-dans-le-calvados" class="anchor"></a>Corriger le code commune de l’Oudon dans le Calvados</h3>
<p>La fonction <code>modification_Oudon</code> permet de modifier les codes Insee de l’ancienne commune de l’Oudon (Calvados, 14). Cette commune a connu une modification assez rare (transfert de chef-lieu) qui implique donc parfois des erreurs de codage de la commune dans certaines bases de données. En effet, la commune de l’Oudon a toujours été codée “14697” puis a changé de code devenant “14472” à partir du 07/01/2014 suite à un transfert de chef lieu. Cette commune a depuis disparu puisqu’elle est devenue commune déléguée au sein de Saint-Pierre-en-Auge (14654).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Ici, nous allons remplacer les codes communes de l'Oudon dans une table de l'Insee (en COG 2014 mais que nous considérons en COG 2015 uniquement pour cet exemple).</span>
<span class="kw">head</span>(exemple_popcom[<span class="kw">which</span>(exemple_popcom$CODGEO%in%<span class="kw">c</span>(<span class="st">"14472"</span>,<span class="st">"14697"</span>)),])</code></pre></div>
<pre><code>##      CODGEO  LIBGEO P12_POP SUPERF    typoA typoB
## 5159  14697 L'Oudon    1551     55 CLASSE 1     D</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_popcom_oudon &lt;-<span class="st"> </span><span class="kw"><a href="../reference/modification_Oudon.html">modification_Oudon</a></span>(<span class="dt">table_entree=</span>exemple_popcom,<span class="dt">donnees_insee_entree=</span>T,<span class="dt">donnees_insee_sortie=</span>F,<span class="dt">COG=</span><span class="dv">2015</span>)
<span class="kw">head</span>(exemple_popcom_oudon[<span class="kw">which</span>(exemple_popcom$CODGEO%in%<span class="kw">c</span>(<span class="st">"14472"</span>,<span class="st">"14697"</span>)),])</code></pre></div>
<pre><code>##      CODGEO  LIBGEO P12_POP SUPERF    typoA typoB
## 5159  14472 L'Oudon    1551     55 CLASSE 1     D</code></pre>
</div>
</div>
<div id="transformer-des-variables-numeriques-en-autre-geographie-dans-des-donnees-de-flux" class="section level2">
<h2 class="hasAnchor">
<a href="#transformer-des-variables-numeriques-en-autre-geographie-dans-des-donnees-de-flux" class="anchor"></a>Transformer des variables numériques en autre géographie dans des données de flux</h2>
<p>La fonction <code>changement_COG_varNum</code> peut également s’appliquer à des tables de flux (codes communes pouvant comporter des doublons) grâce à l’option agregation = FALSE. Les variables de type caractère sont alors conservées comme telles ou dupliquées en cas de défusion et les variables numériques (ici IPONDI) sommées en cas de fusion ou réparties proportionnellement à la population de chaque commune en cas de défusion.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_flux_COG2017 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/changement_COG_varNum.html">changement_COG_varNum</a></span>(<span class="dt">table_entree=</span>exemple_flux_sansPLMsansCorse,<span class="dt">annees=</span><span class="kw">c</span>(<span class="dv">2014</span>:<span class="dv">2017</span>),<span class="dt">codgeo_entree=</span><span class="st">"COMMUNE"</span>,<span class="dt">agregation=</span>F,<span class="dt">libgeo=</span>F,<span class="dt">donnees_insee=</span>T)
exemple_flux_COG2017 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/changement_COG_varNum.html">changement_COG_varNum</a></span>(<span class="dt">table_entree=</span>exemple_flux_COG2017,<span class="dt">annees=</span><span class="kw">c</span>(<span class="dv">2014</span>:<span class="dv">2017</span>),<span class="dt">codgeo_entree=</span><span class="st">"DCLT"</span>,<span class="dt">agregation=</span>F,<span class="dt">libgeo=</span>F,<span class="dt">donnees_insee=</span>T)</code></pre></div>
</div>
<div id="inserer-dans-des-tables-de-donnees-de-flux-communales-des-echelons-supra-communaux" class="section level2">
<h2 class="hasAnchor">
<a href="#inserer-dans-des-tables-de-donnees-de-flux-communales-des-echelons-supra-communaux" class="anchor"></a>Insérer dans des tables de données de flux communales des échelons supra-communaux</h2>
<p>La fonction <code>nivsupra</code> peut également s’appliquer à des tables de flux (non agrégées par codes communes) grâce à l’option agregation = FALSE. La table en entrée est alors conservée comme telle avec une nouvelle colonne qui correspond au niveau supracommunal du code commune considéré.</p>
<p>Ici, on ajoute les colonnes ZE2010_COMMUNE et ZE2010_DCLT à la table de flux domicile-travail utilisée précédemment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">exemple_flux_COG2017_etZE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nivsupra.html">nivsupra</a></span>(<span class="dt">table_entree=</span>exemple_flux_COG2017,<span class="dt">codgeo_entree=</span><span class="st">"COMMUNE"</span>,<span class="dt">nivsupra=</span><span class="st">"ZE2010"</span>,<span class="dt">agregation=</span>F,<span class="dt">COG=</span><span class="dv">2017</span>)
exemple_flux_COG2017_etZE &lt;-<span class="st"> </span><span class="kw"><a href="../reference/nivsupra.html">nivsupra</a></span>(<span class="dt">table_entree=</span>exemple_flux_COG2017_etZE,<span class="dt">codgeo_entree=</span><span class="st">"DCLT"</span>,<span class="dt">nivsupra=</span><span class="st">"ZE2010"</span>,<span class="dt">agregation=</span>F,<span class="dt">COG=</span><span class="dv">2017</span>)
<span class="kw">head</span>(exemple_flux_COG2017_etZE)</code></pre></div>
<pre><code>##   COMMUNE  DCLT CS1 AGEREVQ   IPONDI ZE2010_COMMUNE ZE2010_nom_COMMUNE
## 1   61001 61001   4      25 2.856389           0051            Alençon
## 2   61001 61001   3      55 3.040441           0051            Alençon
## 3   61213 53185   2      40 4.142349           0051            Alençon
## 4   61203 61001   5      25 5.234542           0051            Alençon
## 5   61491 61500   5      40 5.578419           0051            Alençon
## 6   61077 61117   4      35 4.153005           0051            Alençon
##   ZE2010_DCLT ZE2010_nom_DCLT
## 1        0051         Alençon
## 2        0051         Alençon
## 3        0051         Alençon
## 4        0051         Alençon
## 5        0051         Alençon
## 6        0051         Alençon</code></pre>
<p>Bonne découverte…!</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction-a-cogugaison">Introduction à COGugaison</a></li>
      <li><a href="#les-bases-de-donnees-utiles-dans-cogugaison">Les bases de données utiles dans COGugaison</a></li>
      <li><a href="#quel-code-officiel-geographique-est-utilise">Quel code officiel géographique est utilisé ?</a></li>
      <li><a href="#visualiser-les-modifications-communales">Visualiser les modifications communales</a></li>
      <li><a href="#transformer-des-variables-numeriques-en-autre-geographie">Transformer des variables numériques en autre géographie</a></li>
      <li><a href="#transformer-des-typologies-en-autre-geographie">Transformer des typologies en autre géographie</a></li>
      <li><a href="#agreger-des-tables-de-donnees-communales-a-des-echelons-supra-communaux">Agréger des tables de données communales à des échelons supra-communaux</a></li>
      <li><a href="#gerer-des-cas-particuliers-dans-les-bases-de-donnees">Gérer des cas particuliers dans les bases de données</a></li>
      <li><a href="#transformer-des-variables-numeriques-en-autre-geographie-dans-des-donnees-de-flux">Transformer des variables numériques en autre géographie dans des données de flux</a></li>
      <li><a href="#inserer-dans-des-tables-de-donnees-de-flux-communales-des-echelons-supra-communaux">Insérer dans des tables de données de flux communales des échelons supra-communaux</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by  antuki.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
